---
title: "haplo-stats"
description: |
  impute high resolution (four digit) alleles; using haplo-stats algorithm
output:
  rmarkdown::html_vignette: default
vignette: |
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{hla-stats}
  %\usepackage[utf8]{inputenc}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## work in progress

```{r}
library(hlaR)
library(tidyverse)
library(readxl)
library(janitor)
```

## import haplostats reference data

Provide references and links.  Describe data and approach

```{r}
haplo_stats <- read_xlsx("data/A~C~B~DRB3-4-5~DRB1~DQB1.xlsx") %>% 
  clean_names()
  

```

    
## Brief exploration of Haplostats 

most common haplotypes by geography and ethnicity



```{r select variables, filter common haplotypes}

hla_common <- haplo_stats %>% 
  select(a:dqb1, aafa_rank, eurcau_rank, mswhis_rank, nchi_rank) %>%
  mutate(across(contains("rank"), as.integer)) %>% 
  filter(aafa_rank <=6 | eurcau_rank <= 6 | mswhis_rank<= 6 | nchi_rank<= 6)


```

##  create some sample subjects

For each group create hypothetical subject by pairing the haplo ranks  1/6, 2/5, 3/4 for each ethnicity/geo
3 EURCAU - 
3 AAFA - 
3 HIS
3 NCHI

```{r create eurcau_subjects}

eurcau_1 <- hla_common %>% 
  select(a:dqb1, eurcau_rank) %>% 
  filter(eurcau_rank <= 6) %>% 
  arrange(eurcau_rank)

eurcau_2 <- eurcau_1 %>% 
  arrange(desc(eurcau_rank))

colnames(eurcau_1) <- paste(colnames(eurcau_1), "1", sep = "_")
colnames(eurcau_2) <- paste(colnames(eurcau_2), "2", sep = "_")

eurcau_subjects <- eurcau_1 %>% 
  cbind(eurcau_2) %>% 
  rowid_to_column() %>% 
  mutate(subject = paste("eurcau", rowid, sep = "_"))

```


```{r create aafa_subjects}

aafa_1 <- hla_common %>% 
  select(a:dqb1, aafa_rank) %>% 
  filter(aafa_rank <= 6) %>% 
  arrange(aafa_rank)

aafa_2 <- aafa_1 %>% 
  arrange(desc(aafa_rank))

colnames(aafa_1) <- paste(colnames(aafa_1), "1", sep = "_")
colnames(aafa_2) <- paste(colnames(aafa_2), "2", sep = "_")

aafa_subjects <- aafa_1 %>% 
  cbind(aafa_2) %>% 
  rowid_to_column() %>% 
  mutate(subject = paste("aafa", rowid, sep = "_"))
```





```{r create mswhis_subjects}

mswhis_1 <- hla_common %>% 
  select(a:dqb1, mswhis_rank) %>% 
  filter(mswhis_rank <= 6) %>% 
  arrange(mswhis_rank)

mswhis_2 <- mswhis_1 %>% 
  arrange(desc(mswhis_rank))

colnames(mswhis_1) <- paste(colnames(mswhis_1), "1", sep = "_")
colnames(mswhis_2) <- paste(colnames(mswhis_2), "2", sep = "_")

mswhis_subjects <- mswhis_1 %>% 
  cbind(mswhis_2) %>% 
  rowid_to_column() %>% 
  mutate(subject = paste("mswhis", rowid, sep = "_"))
```


```{r create nchi_subjects}

nchi_1 <- hla_common %>% 
  select(a:dqb1, nchi_rank) %>% 
  filter(nchi_rank <= 6) %>% 
  arrange(nchi_rank)

nchi_2 <- nchi_1 %>% 
  arrange(desc(nchi_rank))

colnames(nchi_1) <- paste(colnames(nchi_1), "1", sep = "_")
colnames(nchi_2) <- paste(colnames(nchi_2), "2", sep = "_")

nchi_subjects <- nchi_1 %>% 
  cbind(nchi_2) %>% 
  rowid_to_column() %>% 
  mutate(subject = paste("nchi", rowid, sep = "_")) 


```


```{r create test_subjects csv}

c <- eurcau_subjects %>% 
  full_join(nchi_subjects) %>% 
  full_join(mswhis_subjects) %>% 
  full_join(aafa_subjects) %>% 
  select(subject, everything(), -rowid)

```


```{r explore synthetic data}
write_csv(test_subjects, "data/test_subjects.csv")
```



## Describe function

## Run sample data

## 

