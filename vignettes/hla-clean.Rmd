---
title: "hla-clean"
description: |
  This vignette shows you how to clean hla data
output:
  rmarkdown::html_vignette: default
vignette: |
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{hla-clean}
  %\usepackage[utf8]{inputenc}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## lookup tables
1. antigen - hla type lookup tables(A, B, and DQB) for special cases
2. tables are created based on best knowledge of combination of Emory data and [IPD-IMGT/HLA Database](http://www.ebi.ac.uk/ipd/imgt/hla/dictionary.html)

## clean logic
implement these logic in order<br>
1. treat all "xx" "un" "N" like strings as NA<br>
2. use lookup table for special cases. ex: 40:05:00	typing is 50, 40:06:00	is 61<br>
3. if there is an NA antigen on either of the copies, replace it with the antigen from the non-na copy,<br>if both copies are NA, then keep them as NA<br>
4. pull out antigen if they show up within (), [], or {}.<br>ex:15(72) -> 1572, *15[62]->1562, or 0302{18}->030218<br>
5. keep only first 2 chars of each antigen<br>
6. add a leading 0 if nchar = 1. ex: 2 will be 02<br>

## other notes:
1. input argument must be both chains of the locus<br>
2. output is a list of cleaned hla string

```{r}
library(hlaR)
library(tidyverse)
```



```{r import sample cohort data}

tx_cohort <- read_csv("data/tx_cohort.csv")
```

[@TODO] Describe the data frame. A cohort of 20 recipients with donor and recipient high resolution HLA typing data for HLA Class I (A, B, C) and HLA Class II (DRB1, DRB3/4/5, and DQb and DQb).

Maybe make this example discoverying epilet vs DSA. have DSA for Class I and Class at xx years.

Describe the variables. recip\_id, recip HLA typing, donor HLA typing. Describe the format/data type for major variables

```{r explore data set}
glimpse(tx_cohort)
```

Describe the function purpose, input output.

```{r clean hla class I}

tx_cohort <- tx_cohort %>% 
  mutate(recipient_a1, recipient_a2, locus = "a")

re <- CleanHLA(tx_cohort$recipient_a1, tx_cohort$recipient_a2, locus = "a")
```



